---
layout: post
title: Variational Inference
date: 2024-05-03
category: Probabilistic-Modelling
use_math: true
---

# Variational inference (VI)란 무엇인가?

[매우 잘 설명되어있는 글,,,](https://velog.io/@gibonki77/Inference-1)

## 1. 베이즈 정리와 함의, 최대사후확률추정 (MAP)
- (중학교 3학년 때부터 지금까지 베이즈 정리만 총 5번을 배웠는데 5번 다 까먹었다.)
- 베이즈 정리는 "확률 변수의 사전 확률과 사후 확률 사이의 관계를 나타내는 정리"다. 이게 대체 무슨 말임?
  - 원인 사건 A1 ~ An 와 이에 따른 결과 사건 B가 주어져 있을 때, 만약 B가 발생했다면 그 원인이 사건 Ai일 확률을 의미한다.
  - 이를 수식으로 나타내면 다음과 같다.  
    $$ P(A_i \mid B) = \frac{P(B \mid A_i) \times P(A_i)}{\sum\limits_{i=1}^n P(B \mid A_i) \times P(A_i)} $$
	
  - $$ \sum\limits_{i=1}^n P(B \mid A_i) \times P(A_i) $$ 는 어떤 경우엔 $$ P(B) $$ 로 요약할 수도 있다. 이는 말 그대로 사건이 일어날 전체 확률이다.
  - $$ P(A_i) $$는 $$ P(B) $$가 발생하기 전부터 알고 있던 $$ A_i $$의 발생 확률이다.
  - $$ P(B \mid A_i) $$는 사건 A_i가 발생했을 때 이에 따라 사건 B가 발생할 확률이다.
- 이 베이즈 정리와 데이터 추론은 대체 무슨 상관이 있을까?
  - 식을 약간 바꿔서, 원인 사건 A는 가설 h로 바꾸고 결과 사건 B는 데이터 D로 바꿔보자.
    $$ P(h \mid D) = \frac{P(D \mid h) \times P(h)}{\sum\limits_{h' \in \mathbf{H}} P(D, h')}$$
  - P(h)는 **사전확률 (prior)** 이다. 데이터를 관측하기 전 가지고 있던 가설을 의미한다.
  - P(D\|h)는 **가능도 (likelihood)** 이다. 가설 h에 따라서 D가 발생할 확률이다.
  - p(h\|D)는 **사후확률 (posterior)** 이다. 데이터 D가 관측되었을 때 그 원리, 또는 데이터의 기저에 있는 추상화된 관계가 가설 h에 기반할 확률이다.
  - 마지막으로 $$ \sum\limits_{h' \in \mathbf{H}} P(D, h') $$ 는  **증거(evidence) 또는 Marginal likelihood**라고 부른다.
  - 즉, 우리가 원하는 것은 **우리의 사전 지식에 기반하여** 이미 D를 관측했을 때 그 D의 원인이 되는 h를 추론하는 과정이다.
    - 예를 들면, 시간 t = \[1, 2, 3\]에 따른 데이터 x = \[2, 4, 6\]이 주어졌다면 기초적인 수학 지식에 기반해 관계를 x = 2t 라고 유추해볼 수 있다.
	- 또는, x = (t-1)(t-2)(t-3) + 2t 라는 결과를 내놓을 수도 있다. (이는 일반적으로 데이터에 과적정된 추론이라고도 볼 수 있을 것이다.)
    - 답이 어느 쪽이든, 여기서 데이터 D는 주어진 t, x의 집합이고, 가설 h는 (상식적인 사전 지식 선에서 떠올릴 수 있는) 모든 t와 x 사이의 관계식이다.
  - 그리고 베이즈 정리에 따른 *가장 그럴듯한 답*은 사후확률이 가장 큰 h, 즉 P(h\|D)를 최대화하는 h이다.
    - 따라서 베이즈 추론은 이런 h ($$ = \underset{h}{\mathrm{argmax}} \ P(h \mid D) $$)를 구하는 과정이라고도 볼 수 있다.
- 이때 $$ \sum\limits_{h' \in \mathbf{H}} P(D, h') $$는 처음부터 가설 공간에 대해 정해져 있는 값이다.
  - 따라서 $$ \underset{h}{\mathrm{argmax}} \ P(h \mid D) $$를 구하는 과정은 자연스럽게 $$ \underset{h}{\mathrm{argmax}} \ P(D \mid h) \times P(h) $$를 구하는 과정이 된다.
  - 이러한 추론을 **최대사후확률추정 (Maximum A Posteriori, MAP)** 라고 한다.

## 2. 최대가능도추정 (MLE)
- 한편 MAP와 자주 비교되는 MLE란 무엇인가?
  - 이것 역시 학부 확률과통계, 기초확률론 등 필수 이수과목에서 분명 2번이나 가르쳤던 것 같은데 또 까먹었다.

## 3. MLE와 MAP